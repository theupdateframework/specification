<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>The Update Framework Specification</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/* color variables included separately for reliability */

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	html {
		color: black;
		color: var(--text);
		background-color: white;
		background-color: var(--bg);
	}

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		background: transparent top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border: solid var(--logo-bg);
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		background: var(--logo-bg);
		color: white;
		color: var(--logo-text);
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		background: var(--logo-active-bg);
		border-color: #c00;
		border-color: var(--logo-active-bg);
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;

			color: #707070;
			color: var(--tocnav-normal-text);
			background: white;
			background: var(--tocnav-normal-bg);
		}
		#toc-nav > a:hover,
		#toc-nav > a:focus {
			color: black;
			color: var(--tocnav-hover-text);
			background: #f8f8f8;
			background: var(--tocnav-hover-bg);
		}
		#toc-nav > a:active {
			color: #c00;
			color: var(--tocnav-active-text);
			background: white;
			background: var(--tocnav-active-bg);
		}

		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		color: var(--heading-text);
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > :not(.head) + hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		color: black;
		color: var(--hr-text);
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	 border-left: 0.5em solid var(--algo-border);
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd;
	  border: thin solid var(--algo-border);
	  border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del {
		color: red;
		color: var(--del-text);
		background: transparent;
		background: var(--del-bg);
		text-decoration: line-through;
	}
	ins {
		color: #080;
		color: var(--ins-text);
		background: transparent;
		background: var(--ins-bg);
		text-decoration: underline;
	}

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		hyphens: none;
		text-transform: none;
		text-align: left;
		text-align: start;
		font-variant: normal;
		orphans: 3;
		widows: 3;
		page-break-before: avoid;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		color: var(--a-normal-text);
		text-decoration: none;
		border-bottom: 1px solid #707070;
		border-bottom: 1px solid var(--a-normal-underline);
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		color: #034575;
		color: var(--a-visited-text);
		border-bottom-color: #bbb;
		border-bottom-color: var(--a-visited-underline);
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		background: var(--a-hover-bg);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #c00;
		color: var(--a-active-text);
		border-color: #c00;
		border-color: var(--a-active-underline);
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	img, svg {
		/* Intentionally not color-scheme aware. */
		background: white;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
		height: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}


	.issue::before, .issue > .marker,
	.example::before, .example > .marker,
	.note::before, .note > .marker,
	details.note > summary > .marker {
		text-transform: uppercase;
		padding-right: 1em;
	}

	.example::before, .example > .marker {
		display: block;
		padding-right: 0em;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
		border-color: var(--blockquote-border);
		background: transparent;
		background: var(--blockquote-bg);
		color: currentcolor;
		color: var(--blockquote-text);
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #e05252;
		border-color: var(--issue-border);
		background: #fbe9e9;
		background: var(--issue-bg);
		color: black;
		color: var(--issue-text);
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		color: #831616;
		color: var(--issueheading-text);
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #e0cb52;
		border-color: var(--example-border);
		background: #fcfaee;
		background: var(--example-bg);
		color: black;
		color: var(--example-text);
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		color: #574b0f;
		color: var(--exampleheading-text);
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52e052;
		border-color: var(--note-border);
		background: #e9fbe9;
		background: var(--note-bg);
		color: black;
		color: var(--note-text);
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary {
		color: hsl(120, 70%, 30%);
		color: var(--noteheading-text);
	}
	/* Add .note::before { content: "Note "; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note[open] > summary {
		border-bottom: 1px silver solid;
		border-bottom: 1px var(--notesummary-underline) solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		border-color: var(--assertion-border);
		background: #EEE;
		background: var(--assertion-bg);
		color: black;
		color: var(--assertion-text);
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-color: var(--advisement-border);
		border-style: none solid;
		background: #fec;
		background: var(--advisement-bg);
		color: black;
		color: var(--advisement-text);
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement::before, .advisement > .marker {
		color: #b35f00;
		color: var(--advisementheading-text);
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: hsla(40,100%,50%,0.95);
		background: var(--warning-bg);
		color: black;
		color: var(--warning-text);
		padding: .75em 1em;
		border: red;
		border: var(--warning-border);
		border-style: solid none;
		box-shadow: 0 2px 8px black;
		text-align: center;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

	@media not print {
		details.annoying-warning[open] {
			position: fixed;
			left: 0;
			right: 0;
			bottom: 2em;
			z-index: 1000;
		}
	}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #def;
		background: var(--def-bg);
		margin: 1.2em 0;
		border-left: 0.5em solid #8ccbf2;
		border-left: 0.5em solid var(--def-border);
		color: black;
		color: var(--def-text);
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
		border-bottom: 1px solid var(--defrow-border);
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def td.footnote {
		padding-top: 0.6em;
	}
	table.def td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-color: var(--datacell-border);
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		border-top: 1px solid var(--datacell-border);
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		border: 1px solid var(--datacell-border);
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
		vertical-align: baseline;
		text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		color: var(--toclink-text);
		border-color: #3980b5;
		border-color: var(--toclink-underline);
	}
	.toc a:visited {
		color: black;
		color: var(--toclink-visited-text);
		border-color: #054572;
		border-color: var(--toclink-visited-underline);
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li .secno { font-size: 85%; }
	.toc > li li li li li { font-size:   85%;    }
	.toc > li li li li li .secno { font-size: 100%; }

	/* @supports not (display:grid) { */
		.toc > li             { margin: 1.5rem 0;    }
		.toc > li li          { margin: 0.3rem 0;    }
		.toc > li li li       { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}

		.toc li {
			clear: both;
		}

		:not(li) > .toc              { margin-left:  5rem; }
		.toc .secno                  { margin-left: -5rem; }
		.toc > li li li .secno       { margin-left: -7rem; }
		.toc > li li li li .secno    { margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc              { margin-left:  4rem; }
			.toc .secno                  { margin-left: -4rem; }
			.toc > li li li              { margin-left:  1rem; }
			.toc > li li li .secno       { margin-left: -5rem; }
			.toc > li li li li .secno    { margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
		/* Loosen it on wide screens */
		@media screen and (min-width: 78em) {
			body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
			body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
			body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
			body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
			body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
			body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			   comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
		}
		#toc .content:hover,
		#toc .content:focus {
			background: rgba(75%, 75%, 75%, .25);
			background: var(--a-hover-bg);
			border-bottom: 3px solid #054572;
			border-bottom: 3px solid var(--toclink-underline);
			margin-bottom: -3px;
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span:not(.dfn-paneled) {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
			color: var(--indexinfo-text);
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		color: black;
		color: var(--indextable-hover-text);
		background: #f7f8f9;
		background: var(--indextable-hover-bg);
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good table positioning:
		   "content column" is 50ems wide at max; less on smaller screens.
		   Extra space (after ToC + content) is empty on the right.

		   1. When table < content column, centers table in column.
		   2. When content < table < available, left-aligns.
		   3. When table > available, fills available + scroll bar.
		*/
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version 89ebb6ab, updated Fri Oct 9 15:32:07 2020 -0700" name="generator">
  <meta content="fd7414086c9ffae38fc7959e0f27bc6dba28987b" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
html {
    color: black;
    color: var(--text);
    background-color: white;
    background-color: var(--bg);
}
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #707070;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #bbb;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">The Update Framework Specification</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">A Collection of Interesting Ideas, <time class="dt-updated" datetime="2020-10-12">12 October 2020</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/theupdateframework/specification/issues/">GitHub</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><span class="p-name fn">foo</span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>todo</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#scope"><span class="secno">1.1</span> <span class="content">Scope</span></a>
      <li><a href="#motivation"><span class="secno">1.2</span> <span class="content">Motivation</span></a>
      <li><a href="#history-and-credit"><span class="secno">1.3</span> <span class="content">History and credit</span></a>
      <li><a href="#non-goals"><span class="secno">1.4</span> <span class="content">Non-goals</span></a>
      <li>
       <a href="#goals"><span class="secno">1.5</span> <span class="content">Goals</span></a>
       <ol class="toc">
        <li><a href="#goals-for-implementation"><span class="secno">1.5.1</span> <span class="content">Goals for implementation</span></a>
        <li><a href="#goals-to-protect-against-specific-attacks"><span class="secno">1.5.2</span> <span class="content">Goals to protect against specific attacks</span></a>
        <li><a href="#goals-for-pki"><span class="secno">1.5.3</span> <span class="content">Goals for PKI</span></a>
        <li><a href="#tuf-augmentation-proposal-support"><span class="secno">1.5.4</span> <span class="content">TUF Augmentation Proposal support</span></a>
       </ol>
     </ol>
    <li>
     <a href="#system-overview"><span class="secno">2</span> <span class="content">System overview</span></a>
     <ol class="toc">
      <li>
       <a href="#roles-and-pki"><span class="secno">2.1</span> <span class="content">Roles and PKI</span></a>
       <ol class="toc">
        <li><a href="#root-role"><span class="secno">2.1.1</span> <span class="content">Root Role</span></a>
        <li><a href="#targets-role"><span class="secno">2.1.2</span> <span class="content">Targets role</span></a>
        <li><a href="#snapshot-role"><span class="secno">2.1.3</span> <span class="content">Snapshot role</span></a>
        <li><a href="#timestamp-role"><span class="secno">2.1.4</span> <span class="content">Timestamp role</span></a>
        <li><a href="#mirrors-role"><span class="secno">2.1.5</span> <span class="content">Mirrors role</span></a>
       </ol>
      <li><a href="#threat-model-and-analysis"><span class="secno">2.2</span> <span class="content">Threat Model And Analysis</span></a>
     </ol>
    <li>
     <a href="#the-repository"><span class="secno">3</span> <span class="content">The repository</span></a>
     <ol class="toc">
      <li>
       <a href="#repository-layout"><span class="secno">3.1</span> <span class="content">Repository layout</span></a>
       <ol class="toc">
        <li><a href="#target-files"><span class="secno">3.1.1</span> <span class="content">Target files</span></a>
        <li>
         <a href="#metadata-files"><span class="secno">3.1.2</span> <span class="content">Metadata files</span></a>
         <ol class="toc">
          <li><a href="#metadata-files-for-targets-delegation"><span class="secno">3.1.2.1</span> <span class="content">Metadata files for targets delegation</span></a>
         </ol>
       </ol>
     </ol>
    <li>
     <a href="#document-formats"><span class="secno">4</span> <span class="content">Document formats</span></a>
     <ol class="toc">
      <li><a href="#metaformat"><span class="secno">4.1</span> <span class="content">Metaformat</span></a>
      <li><a href="#file-formats-general-principles"><span class="secno">4.2</span> <span class="content">File formats: general principles</span></a>
      <li><a href="#file-formats-rootjson"><span class="secno">4.3</span> <span class="content">File formats: root.json</span></a>
      <li><a href="#file-formats-snapshotjson"><span class="secno">4.4</span> <span class="content">File formats: snapshot.json</span></a>
      <li><a href="#file-formats-targetsjson-and-delegated-target-roles"><span class="secno">4.5</span> <span class="content">File formats: targets.json and delegated target roles</span></a>
      <li><a href="#file-formats-timestampjson"><span class="secno">4.6</span> <span class="content">File formats: timestamp.json</span></a>
      <li><a href="#file-formats-mirrorsjson"><span class="secno">4.7</span> <span class="content">File formats: mirrors.json</span></a>
     </ol>
    <li>
     <a href="#detailed-workflows"><span class="secno">5</span> <span class="content">Detailed Workflows</span></a>
     <ol class="toc">
      <li><a href="#the-client-application"><span class="secno">5.1</span> <span class="content">The client application</span></a>
      <li><a href="#load-the-trusted-root-metadata-file"><span class="secno">5.2</span> <span class="content">Load the trusted root metadata file.</span></a>
      <li>
       <a href="#update-the-root-metadata-file"><span class="secno">5.3</span> <span class="content">Update the root metadata file.</span></a>
       <ol class="toc">
        <li><a href="#let-n-denote-the-version-number-of-the-trusted-root-metadata"><span class="secno">5.3.1</span> <span class="content">Let N denote the version number of the trusted root metadata</span></a>
        <li><a href="#try-downloading-version-n1-of-the-root-metadata-file"><span class="secno">5.3.2</span> <span class="content">Try downloading version N+1 of the root metadata file</span></a>
        <li><a href="#check-for-an-arbitrary-software-attack"><span class="secno">5.3.3</span> <span class="content">Check for an arbitrary software attack</span></a>
        <li><a href="#check-for-a-rollback-attack"><span class="secno">5.3.4</span> <span class="content">Check for a rollback attack.**</span></a>
        <li><a href="#note-that-the-expiration-of-the-new-intermediate-root-metadata"><span class="secno">5.3.5</span> <span class="content">Note that the expiration of the new (intermediate) root metadata</span></a>
        <li><a href="#set-the-trusted-root-metadata-file"><span class="secno">5.3.6</span> <span class="content">Set the trusted root metadata file</span></a>
        <li><a href="#persist-root-metadata"><span class="secno">5.3.7</span> <span class="content">Persist root metadata</span></a>
        <li><a href="#repeat-steps-511-to-518"><span class="secno">5.3.8</span> <span class="content">Repeat steps 5.1.1 to 5.1.8</span></a>
        <li><a href="#check-for-a-freeze-attack"><span class="secno">5.3.9</span> <span class="content">Check for a freeze attack</span></a>
        <li><a href="#if-the-timestamp-and-or-snapshot-keys-have-been-rotated"><span class="secno">5.3.10</span> <span class="content">If the timestamp and / or snapshot keys have been rotated,</span></a>
        <li><a href="#set-whether-consistent-snapshots-are-used-as-per-the-trusted"><span class="secno">5.3.11</span> <span class="content">**Set whether consistent snapshots are used as per the trusted</span></a>
       </ol>
      <li>
       <a href="#download-the-timestamp-metadata-file-up-to-x-number-of-bytes"><span class="secno">5.4</span> <span class="content">**Download the timestamp metadata file**, up to X number of bytes</span></a>
       <ol class="toc">
        <li><a href="#check-for-an-arbitrary-software-attack①"><span class="secno">5.4.1</span> <span class="content">Check for an arbitrary software attack</span></a>
        <li>
         <a href="#check-for-a-rollback-attack①"><span class="secno">5.4.2</span> <span class="content">Check for a rollback attack</span></a>
         <ol class="toc">
          <li><a href="#the-version-number-of-the-trusted-timestamp-metadata-file-if"><span class="secno">5.4.2.1</span> <span class="content">The version number of the trusted timestamp metadata file, if</span></a>
          <li><a href="#the-version-number-of-the-snapshot-metadata-file-in-the"><span class="secno">5.4.2.2</span> <span class="content">The version number of the snapshot metadata file in the</span></a>
         </ol>
        <li><a href="#check-for-a-freeze-attack①"><span class="secno">5.4.3</span> <span class="content">Check for a freeze attack</span></a>
        <li><a href="#persist-timestamp-metadata"><span class="secno">5.4.4</span> <span class="content">Persist timestamp metadata</span></a>
       </ol>
      <li>
       <a href="#download-snapshot-metadata-file-up-to-either-the-number-of-bytes"><span class="secno">5.5</span> <span class="content">**Download snapshot metadata file**, up to either the number of bytes</span></a>
       <ol class="toc">
        <li><a href="#check-against-timestamp-metadata"><span class="secno">5.5.1</span> <span class="content">Check against timestamp metadata</span></a>
        <li><a href="#check-for-an-arbitrary-software-attack②"><span class="secno">5.5.2</span> <span class="content">Check for an arbitrary software attack</span></a>
        <li><a href="#check-for-a-rollback-attack②"><span class="secno">5.5.3</span> <span class="content">Check for a rollback attack</span></a>
        <li><a href="#check-for-a-freeze-attack②"><span class="secno">5.5.4</span> <span class="content">Check for a freeze attack</span></a>
        <li><a href="#persist-snapshot-metadata"><span class="secno">5.5.5</span> <span class="content">Persist snapshot metadata</span></a>
       </ol>
      <li>
       <a href="#download-the-top-level-targets-metadata-file-up-to-either-the"><span class="secno">5.6</span> <span class="content">**Download the top-level targets metadata file**, up to either the</span></a>
       <ol class="toc">
        <li><a href="#check-against-snapshot-metadata"><span class="secno">5.6.1</span> <span class="content">Check against snapshot metadata</span></a>
        <li><a href="#check-for-an-arbitrary-software-attack③"><span class="secno">5.6.2</span> <span class="content">**Check for an arbitrary software attack</span></a>
        <li><a href="#check-for-a-freeze-attack③"><span class="secno">5.6.3</span> <span class="content">**Check for a freeze attack</span></a>
        <li><a href="#persist-targets-metadata"><span class="secno">5.6.4</span> <span class="content">Persist targets metadata</span></a>
        <li>
         <a href="#perform-a-pre-order-depth-first-search-for-metadata-about-the-desired-target-beginning-with-the-top-level-targets-role"><span class="secno">5.6.5</span> <span class="content">Perform a pre-order depth-first search for metadata about the desired target, beginning with the top-level targets role</span></a>
         <ol class="toc">
          <li><a href="#if-this-role-has-been-visited-before-then-skip-this-role"><span class="secno">5.6.5.1</span> <span class="content">If this role has been visited before, then skip this role</span></a>
          <li>
           <a href="#otherwise-recursively-search-the-list-of-delegations-in"><span class="secno">5.6.5.2</span> <span class="content">Otherwise, recursively search the list of delegations in</span></a>
           <ol class="toc">
            <li><a href="#if-the-current-delegation-is-a-multi-role-delegation"><span class="secno">5.6.5.2.1</span> <span class="content">If the current delegation is a multi-role delegation,</span></a>
            <li><a href="#if-the-current-delegation-is-a-terminating-delegation"><span class="secno">5.6.5.2.2</span> <span class="content">If the current delegation is a terminating delegation,</span></a>
            <li><a href="#otherwise-if-the-current-delegation-is-a"><span class="secno">5.6.5.2.3</span> <span class="content">Otherwise, if the current delegation is a</span></a>
           </ol>
         </ol>
       </ol>
      <li>
       <a href="#verify-the-desired-target-against-its-targets-metadata"><span class="secno">5.7</span> <span class="content">**Verify the desired target against its targets metadata**.</span></a>
       <ol class="toc">
        <li><a href="#if-there-is-no-targets-metadata-about-this-target-abort-the"><span class="secno">5.7.1</span> <span class="content">If there is no targets metadata about this target, abort the</span></a>
        <li><a href="#otherwise-download-the-target-up-to-the-number-of-bytes"><span class="secno">5.7.2</span> <span class="content">Otherwise, download the target (up to the number of bytes</span></a>
       </ol>
     </ol>
    <li>
     <a href="#usage"><span class="secno">6</span> <span class="content">Usage</span></a>
     <ol class="toc">
      <li><a href="#key-management-and-migration"><span class="secno">6.1</span> <span class="content">Key management and migration</span></a>
     </ol>
    <li>
     <a href="#consistent-snapshots"><span class="secno">7</span> <span class="content">Consistent Snapshots</span></a>
     <ol class="toc">
      <li><a href="#writing-consistent-snapshots"><span class="secno">7.1</span> <span class="content">Writing consistent snapshots</span></a>
      <li><a href="#reading-consistent-snapshots"><span class="secno">7.2</span> <span class="content">Reading consistent snapshots</span></a>
     </ol>
    <li>
     <a href="#future-directions-and-open-questions"><span class="secno">8</span> <span class="content">Future directions and open questions</span></a>
     <ol class="toc">
      <li><a href="#support-for-bogus-clocks"><span class="secno">8.1</span> <span class="content">Support for bogus clocks.</span></a>
     </ol>
    <li><a href="#conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <p>Last modified: **30 September 2020**</p>
   <p>Version: **1.0.9**</p>
   <p>We strive to make the specification easy to implement, so if you come across
any inconsistencies or experience any difficulty, do let us know by sending an
email to our [mailing
list](https://groups.google.com/forum/?fromgroups#!forum/theupdateframework),
or by reporting an issue in the [specification
repo](https://github.com/theupdateframework/specification/issues).</p>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <h3 class="heading settled" data-level="1.1" id="scope"><span class="secno">1.1. </span><span class="content">Scope</span><a class="self-link" href="#scope"></a></h3>
   <p>This document describes a framework for securing software update systems.</p>
   <p>The keywords "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD,"
   "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are to be
   interpreted as described in [RFC 2119](https://tools.ietf.org/html/rfc2119).</p>
   <h3 class="heading settled" data-level="1.2" id="motivation"><span class="secno">1.2. </span><span class="content">Motivation</span><a class="self-link" href="#motivation"></a></h3>
   <p>Software is commonly updated through software update systems.  These systems
   can be package managers that are responsible for all of the software that is
   installed on a system, application updaters that are only responsible for
   individual installed applications, or software library managers that install
   software that adds functionality such as plugins or programming language
   libraries.</p>
   <p>Software update systems all have the common behavior of downloading files
   that identify whether updates exist and, when updates do exist, downloading
   the files that are required for the update.  For the implementations
   concerned with security, various integrity and authenticity checks are
   performed on downloaded files.</p>
   <p>Software update systems are vulnerable to a variety of known attacks.  This
   is generally true even for implementations that have tried to be secure.</p>
   <h3 class="heading settled" data-level="1.3" id="history-and-credit"><span class="secno">1.3. </span><span class="content">History and credit</span><a class="self-link" href="#history-and-credit"></a></h3>
   <p>Work on TUF began in late 2009.  The core ideas are based off of previous
   work done by Justin Cappos and Justin Samuel that [identified security flaws
   in all popular Linux package managers](https://theupdateframework.io/papers/attacks-on-package-managers-ccs2008.pdf).
   More information and current versions of this document can be found at
   https://theupdateframework.io/</p>
   <p>The [Global Environment for Network Innovations](https://www.geni.net/) (GENI)
   and the [National Science Foundation](https://www.nsf.gov/) (NSF) have
   provided support for the development of TUF.</p>
   <p>TUF’s reference implementation is based on prior work on
   [Thandy](https://www.torproject.org/), the application
   updater for Tor. Its design and this spec
   also came from ideas jointly developed in discussion with Thandy’s authors.
   The Thandy spec can be found at
   https://gitweb.torproject.org/thandy.git/tree/specs/thandy-spec.txt</p>
   <p>Whereas Thandy is an application updater for an individual software project,
   TUF aims to provide a way to secure any software update system. We’re very
   grateful to the Tor Project and the Thandy developers for the early discussion
   that led to the ideas in Thandy and TUF. Thandy is the hard
   work of Nick Mathewson, Sebastian Hahn, Roger Dingledine, Martin Peck, and
   others.</p>
   <h3 class="heading settled" data-level="1.4" id="non-goals"><span class="secno">1.4. </span><span class="content">Non-goals</span><a class="self-link" href="#non-goals"></a></h3>
   <p>We are not creating a universal update system, but rather a simple and
   flexible way that applications can have high levels of security with their
   software update systems.  Creating a universal software update system would
   not be a reasonable goal due to the diversity of application-specific
   functionality in software update systems and the limited usefulness that
   such a system would have for securing legacy software update systems.</p>
   <p>We won’t be defining package formats or even performing the actual update
   of application files.  We will provide the simplest mechanism possible that
   remains easy to use and provides a secure way for applications to obtain and
   verify files being distributed by trusted parties.</p>
   <p>We are not providing a means to bootstrap security so that arbitrary
   installation of new software is secure.  In practice this means that people
   still need to use other means to verify the integrity and authenticity of
   files they download manually.</p>
   <p>The framework will not have the responsibility of deciding on the correct
   course of action in all error situations, such as those that can occur when
   certain attacks are being performed.  Instead, the framework will provide
   the software update system the relevant information about any errors that
   require security decisions which are situation-specific.  How those errors
   are handled is up to the software update system.</p>
   <h3 class="heading settled" data-level="1.5" id="goals"><span class="secno">1.5. </span><span class="content">Goals</span><a class="self-link" href="#goals"></a></h3>
   <p>We need to provide a framework (a set of libraries, file formats, and
   utilities) that can be used to secure new and existing software update
   systems.</p>
   <p>The framework should enable applications to be secure from all known attacks
   on the software update process.  It is not concerned with exposing
   information about what software is being updated (and thus what software
   the client may be running) or the contents of updates.</p>
   <p>The framework should provide means to minimize the impact of key compromise.
   To do so, it must support roles with multiple keys and threshold/quorum
   trust (with the exception of minimally trusted roles designed to use a
   single key).  The compromise of roles using highly vulnerable keys should
   have minimal impact.  Therefore, online keys (keys which are used in an
   automated fashion) must not be used for any role that clients ultimately
   trust for files they may install.</p>
   <p>The framework must be flexible enough to meet the needs of a wide variety of
   software update systems.</p>
   <p>The framework must be easy to integrate with software update systems.</p>
   <h4 class="heading settled" data-level="1.5.1" id="goals-for-implementation"><span class="secno">1.5.1. </span><span class="content">Goals for implementation</span><a class="self-link" href="#goals-for-implementation"></a></h4>
   <ul>
    <li data-md>
     <p>The client side of the framework must be straightforward to implement in any
programming language and for any platform with the requisite networking and
crypto support.</p>
    <li data-md>
     <p>The process by which developers push updates to the repository must be
 simple.</p>
    <li data-md>
     <p>The framework must be secure to use in environments that lack support for
SSL (TLS).  This does not exclude the optional use of SSL when available,
but the framework will be designed without it.</p>
   </ul>
   <h4 class="heading settled" data-level="1.5.2" id="goals-to-protect-against-specific-attacks"><span class="secno">1.5.2. </span><span class="content">Goals to protect against specific attacks</span><a class="self-link" href="#goals-to-protect-against-specific-attacks"></a></h4>
   <p class="note" role="note"><span>Note:</span> When saying the framework protects against an attack, it means the
      attack will be unsuccessful.  It does not mean that a client will always
      successfully update during an attack.  Fundamentally, an attacker
      positioned to intercept and modify a client’s communication can always
      perform a denial of service.  Nevertheless, the framework must detect
      when a client is unable to update.</p>
   <ul>
    <li data-md>
     <p>**Arbitrary installation attacks.** An attacker cannot install anything
they want on the client system. That is, an attacker cannot provide
arbitrary files in response to download requests.</p>
    <li data-md>
     <p>**Endless data attacks.**  An attacker cannot respond to client
requests with huge amounts of data (extremely large files) that interfere
with the client’s system.</p>
    <li data-md>
     <p>**Extraneous dependencies attacks.**  An attacker cannot cause clients
to download or install software dependencies that are not the intended
dependencies.</p>
    <li data-md>
     <p>**Fast-forward attacks.**  An attacker cannot arbitrarily increase the
version numbers of metadata files, listed in the snapshot metadata, well
beyond the current value and thus tricking a software update system into
thinking any subsequent updates are trying to rollback the package to a
previous, out-of-date version.  In some situations, such as those where
there is a maximum possible version number, the perpetrator cannot use a
number so high that the system would never be able to match it with the
one in the snapshot metadata, and thus new updates could never be
downloaded.</p>
    <li data-md>
     <p>**Indefinite freeze attacks.**  An attacker cannot respond to client
requests with the same, outdated metadata without the client being aware
of the problem.</p>
    <li data-md>
     <p>**Malicious mirrors preventing updates.**  A repository mirror cannot
prevent updates from good mirrors.</p>
    <li data-md>
     <p>**Mix-and-match attacks.**  An attacker cannot trick clients into using
a combination of metadata that never existed together on the repository
at the same time.</p>
    <li data-md>
     <p>**Rollback attacks.**  An attacker cannot trick clients into installing
software that is older than that which the client previously knew to be
available.</p>
    <li data-md>
     <p>**Vulnerability to key compromises.** An attacker, who is able to
compromise a single key or less than a given threshold of keys, cannot
compromise clients.  This includes compromising a single online key (such
as only being protected by SSL) or a single offline key (such as most
software update systems use to sign files).</p>
    <li data-md>
     <p>**Wrong software installation.**  An attacker cannot provide a file
(trusted or untrusted) that is not the one the client wanted.</p>
   </ul>
   <h4 class="heading settled" data-level="1.5.3" id="goals-for-pki"><span class="secno">1.5.3. </span><span class="content">Goals for PKI</span><a class="self-link" href="#goals-for-pki"></a></h4>
   <ul>
    <li data-md>
     <p>Software update systems using the framework’s client code interface should
never have to directly manage keys.</p>
    <li data-md>
     <p>All keys must be easily and safely revocable.  Trusting new keys for a role
must be easy.</p>
    <li data-md>
     <p>For roles where trust delegation is meaningful, a role should be able to
delegate full or limited trust to another role.</p>
    <li data-md>
     <p>The root of trust must not rely on external PKI.  That is, no authority will
be derived from keys outside of the framework.</p>
   </ul>
   <h4 class="heading settled" data-level="1.5.4" id="tuf-augmentation-proposal-support"><span class="secno">1.5.4. </span><span class="content">TUF Augmentation Proposal support</span><a class="self-link" href="#tuf-augmentation-proposal-support"></a></h4>
   <ul>
    <li data-md>
     <p>This version (1.0.0) of the specification adheres to the following TAPS:</p>
     <ul>
      <li data-md>
       <p>[TAP 6](https://github.com/theupdateframework/taps/blob/master/tap6.md):
  Include specification version in metadata</p>
      <li data-md>
       <p>[TAP 9](https://github.com/theupdateframework/taps/blob/master/tap9.md):
  Mandatory Metadata signing schemes</p>
      <li data-md>
       <p>[Tap 10](https://github.com/theupdateframework/taps/blob/master/tap10.md):
  Remove native support for compressed metadata</p>
     </ul>
     <p>Implementations compliant with this version (1.0.0) of the specification
must also comply with the TAPs mentioned above.</p>
   </ul>
   <h2 class="heading settled" data-level="2" id="system-overview"><span class="secno">2. </span><span class="content">System overview</span><a class="self-link" href="#system-overview"></a></h2>
   <p>The framework ultimately provides a secure method of obtaining trusted
   files.  To avoid ambiguity, we will refer to the files the framework is used
   to distribute as "target files".  Target files are opaque to the framework.
   Whether target files are packages containing multiple files, single text
   files, or executable binaries is irrelevant to the framework.</p>
   <p>The metadata describing target files is the information necessary to
   securely identify the file and indicate which roles are trusted to provide
   the file.  As providing additional information about
   target files may be important to some software update systems using the
   framework, additional arbitrary information can be provided with any target
   file. This information will be included in signed metadata that describes
   the target files.</p>
   <p>The following are the high-level steps of using the framework from the
   viewpoint of a software update system using the framework.  This is an
   error-free case.</p>
   <p>Polling:
            Periodically, the software update system using the framework
            instructs the framework to check each repository for updates.  If
            the framework reports to the application code that there are
            updates, the application code determines whether it wants to
            download the updated target files.  Only target files that are
            trusted (referenced by properly signed and timely metadata) are
            made available by the framework.</p>
   <p>Fetching:
            For each file that the application wants, it asks the framework to
            download the file.  The framework downloads the file and performs
            security checks to ensure that the downloaded file is exactly what
            is expected according to the signed metadata.  The application code
            is not given access to the file until the security checks have been
            completed.  The application asks the framework to copy the
            downloaded file to a location specified by the application.  At
            this point, the application has securely obtained the target file
            and can do with it whatever it wishes.</p>
   <h3 class="heading settled" data-level="2.1" id="roles-and-pki"><span class="secno">2.1. </span><span class="content">Roles and PKI</span><a class="self-link" href="#roles-and-pki"></a></h3>
   <p>In the discussion of roles that follows, it is important to remember that
   the framework has been designed to allow a large amount of flexibility for
   many different use cases.  For example, it is possible to use the framework
   with a single key that is the only key used in the entire system.  This is
   considered to be insecure but the flexibility is provided in order to meet
   the needs of diverse use cases.</p>
   <p>There are four fundamental top-level roles in the framework:</p>
   <ul>
    <li data-md>
     <p>Root role</p>
    <li data-md>
     <p>Targets role</p>
    <li data-md>
     <p>Snapshot role</p>
    <li data-md>
     <p>Timestamp role</p>
   </ul>
   <p>There is also one optional top-level role:</p>
   <ul>
    <li data-md>
     <p>Mirrors role</p>
   </ul>
   <p>All roles can use one or more keys and require a threshold of signatures of
   the role’s keys in order to trust a given metadata file.</p>
   <h4 class="heading settled" data-level="2.1.1" id="root-role"><span class="secno">2.1.1. </span><span class="content">Root Role</span><a class="self-link" href="#root-role"></a></h4>
   <ul>
    <li data-md>
     <p>The root role delegates trust to specific keys trusted for all other
top-level roles used in the system.</p>
    <li data-md>
     <p>The client-side of the framework MUST ship with trusted root keys for each
configured repository.</p>
    <li data-md>
     <p>The root role’s private keys MUST be kept very secure and thus should be
kept offline.  If less than a threshold of Root keys are compromised, the
repository should revoke trust on the compromised keys.  This can be
accomplished with a normal rotation of root keys, covered in section 6.1
(Key management and migration). If a threshold of root keys is compromised,
the Root keys should be updated out-of-band, however, the threshold should
be chosen so that this is extremely unlikely.  In the unfortunate event that
a threshold of keys are compromised, it is safest to assume that attackers
have installed malware and taken over affected machines.  For this reason,
making it difficult for attackers to compromise all of the offline keys is
important because safely recovering from it is nearly impossible.</p>
   </ul>
   <h4 class="heading settled" data-level="2.1.2" id="targets-role"><span class="secno">2.1.2. </span><span class="content">Targets role</span><a class="self-link" href="#targets-role"></a></h4>
   <p>The targets role’s signature indicates which target files are trusted by
      clients.  The targets role signs metadata that describes these files, not
      the actual target files themselves.</p>
   <p>In addition, the targets role can delegate full or partial trust to other
      roles.  Delegating trust means that the targets role indicates another role
      (that is, another set of keys and the threshold required for trust) is
      trusted to sign target file metadata.  Partial trust delegation is when the
      delegated role is only trusted for some of the target files that the
      delegating role is trusted for.</p>
   <p>Delegated roles can further delegate trust to other delegated
      roles.  This provides for multiple levels of trust delegation where each
      role can delegate full or partial trust for the target files they are
      trusted for.  The delegating role in these cases is still trusted.  That is,
      a role does not become untrusted when it has delegated trust.</p>
   <p>Any delegation can be revoked at any time: the delegating role needs only
      to sign new metadata that no longer contains that delegation.</p>
   <h4 class="heading settled" data-level="2.1.3" id="snapshot-role"><span class="secno">2.1.3. </span><span class="content">Snapshot role</span><a class="self-link" href="#snapshot-role"></a></h4>
   <p>The snapshot role signs a metadata file that provides information about
      the latest version of all targets metadata on the repository
      (the top-level targets role and all delegated roles).  This information allows
      clients to know which metadata files have been updated and also prevents
      mix-and-match attacks.</p>
   <h4 class="heading settled" data-level="2.1.4" id="timestamp-role"><span class="secno">2.1.4. </span><span class="content">Timestamp role</span><a class="self-link" href="#timestamp-role"></a></h4>
   <p>To prevent an adversary from replaying an out-of-date signed metadata file
      whose signature has not yet expired, an automated process periodically signs
      a timestamped statement containing the hash of the snapshot file.  Even
      though this timestamp key must be kept online, the risk posed to clients by
      the compromise of this key is minimal.</p>
   <h4 class="heading settled" data-level="2.1.5" id="mirrors-role"><span class="secno">2.1.5. </span><span class="content">Mirrors role</span><a class="self-link" href="#mirrors-role"></a></h4>
   <p>Every repository has one or more mirrors from which files can be downloaded
      by clients.  A software update system using the framework may choose to
      hard-code the mirror information in their software or they may choose to use
      mirror metadata files that can optionally be signed by a mirrors role.</p>
   <p>The importance of using signed mirror lists depends on the application and
      the users of that application.  There is minimal risk to the application’s
      security from being tricked into contacting the wrong mirrors.  This is
      because the framework has very little trust in repositories.</p>
   <h3 class="heading settled" data-level="2.2" id="threat-model-and-analysis"><span class="secno">2.2. </span><span class="content">Threat Model And Analysis</span><a class="self-link" href="#threat-model-and-analysis"></a></h3>
   <p>We assume an adversary who can respond to client requests, whether by acting
   as a man-in-the-middle or through compromising repository mirrors.  At
   worst, such an adversary can deny updates to users if no good mirrors are
   accessible.  An inability to obtain updates is noticed by the framework.</p>
   <p>If an adversary compromises enough keys to sign metadata, the best that can
   be done is to limit the number of users who are affected.  The level to
   which this threat is mitigated is dependent on how the application is using
   the framework.  This includes whether different keys have been used for
   different signing roles.</p>
   <p>A detailed threat analysis is outside the scope of this document.  This is
   partly because the specific threat posted to clients in many situations is
   largely determined by how the framework is being used.</p>
   <h2 class="heading settled" data-level="3" id="the-repository"><span class="secno">3. </span><span class="content">The repository</span><a class="self-link" href="#the-repository"></a></h2>
   <p>An application uses the framework to interact with one or more repositories.
   A repository is a conceptual source of target files of interest to the
   application.  Each repository has one or more mirrors which are the actual
   providers of files to be downloaded.  For example, each mirror may specify a
   different host where files can be downloaded from over HTTP.</p>
   <p>The mirrors can be full or partial mirrors as long as the application-side
   of the framework can ultimately obtain all of the files it needs.  A mirror
   is a partial mirror if it is missing files that a full mirror should have.
   If a mirror is intended to only act as a partial mirror, the metadata and
   target paths available from that mirror can be specified.</p>
   <p>Roles, trusted keys, and target files are completely separate between
   repositories.  A multi-repository setup is a multi-root system.  When an
   application uses the framework with multiple repositories, the framework
   does not perform any "mixing" of the trusted content from each repository.
   It is up to the application to determine the significance of the same or
   different target files provided from separate repositories.</p>
   <h3 class="heading settled" data-level="3.1" id="repository-layout"><span class="secno">3.1. </span><span class="content">Repository layout</span><a class="self-link" href="#repository-layout"></a></h3>
   <p>The filesystem layout in the repository is used for two purposes:</p>
   <ul>
    <li data-md>
     <p>To give mirrors an easy way to mirror only some of the repository.</p>
    <li data-md>
     <p>To specify which parts of the repository a given role has authority
   to sign/provide.</p>
   </ul>
   <h4 class="heading settled" data-level="3.1.1" id="target-files"><span class="secno">3.1.1. </span><span class="content">Target files</span><a class="self-link" href="#target-files"></a></h4>
   <p>The filenames and the directory structure of target files available from
   a repository are not specified by the framework.  The names of these files
   and directories are completely at the discretion of the application using
   the framework.</p>
   <h4 class="heading settled" data-level="3.1.2" id="metadata-files"><span class="secno">3.1.2. </span><span class="content">Metadata files</span><a class="self-link" href="#metadata-files"></a></h4>
   <p>The filenames and directory structure of repository metadata are strictly
   defined.  All metadata filenames will have an extension (EXT) based on the
   metaformat, for example JSON metadata files would have an EXT of json.
   The following are the metadata files of top-level roles relative
   to the base URL of metadata available from a given repository mirror.</p>
   <p>/root.EXT</p>
   <p>Signed by the root keys; specifies trusted keys for the other
         top-level roles.</p>
   <p>/snapshot.EXT</p>
   <p>Signed by the snapshot role’s keys.  Lists the version numbers of all
         target metadata files: the top-level targets.EXT and all delegated
         roles.</p>
   <p>/targets.EXT</p>
   <p>Signed by the target role’s keys.  Lists hashes and sizes of target
         files. Specifies delegation information and trusted keys for delegated
         target roles.</p>
   <p>/timestamp.EXT</p>
   <p>Signed by the timestamp role’s keys.  Lists hash(es), size, and version
         number of the snapshot file.  This is the first and potentially only
         file that needs to be downloaded when clients poll for the existence
         of updates.</p>
   <p>/mirrors.EXT (optional)</p>
   <p>Signed by the mirrors role’s keys.  Lists information about available
         mirrors and the content available from each mirror.</p>
   <h5 class="heading settled" data-level="3.1.2.1" id="metadata-files-for-targets-delegation"><span class="secno">3.1.2.1. </span><span class="content">Metadata files for targets delegation</span><a class="self-link" href="#metadata-files-for-targets-delegation"></a></h5>
   <p>When the targets role delegates trust to other roles, each delegated role
   provides one signed metadata file.  As is the case with the directory
   structure of top-level metadata, the delegated files are relative to the
   base URL of metadata available from a given repository mirror.</p>
   <p>A delegated role file is located at:</p>
   <p>/DELEGATED_ROLE.EXT</p>
   <p>where DELEGATED_ROLE is the name of the delegated role that has been
   specified in targets.EXT.  If this role further delegates trust to a role
   named ANOTHER_ROLE, that role’s signed metadata file is made available at:</p>
   <p>/ANOTHER_ROLE.EXT</p>
   <p>Delegated target roles are authorized by the keys listed in the directly
   delegating target role.</p>
   <h2 class="heading settled" data-level="4" id="document-formats"><span class="secno">4. </span><span class="content">Document formats</span><a class="self-link" href="#document-formats"></a></h2>
   <p>All of the formats described below include the ability to add more
   attribute-value fields for backwards-compatible format changes.  If
   a backwards incompatible format change is needed, a new filename can
   be used.</p>
   <h3 class="heading settled" data-level="4.1" id="metaformat"><span class="secno">4.1. </span><span class="content">Metaformat</span><a class="self-link" href="#metaformat"></a></h3>
   <p>Implementers of TUF may use any data format for metadata files as long as
   all fields in this specification are included and TUF clients are able to
   interpret them without ambiguity. Implementers should choose a data format
   that allows for canonicalization, or one that will decode data
   deterministically by default so that signatures can be accurately verified.
   The examples in this document use a subset of the JSON object format, with
   floating-point numbers omitted.  When calculating the digest of an
   object, we use the "canonical JSON" subdialect as described at
        http://wiki.laptop.org/go/Canonical_JSON</p>
   <h3 class="heading settled" data-level="4.2" id="file-formats-general-principles"><span class="secno">4.2. </span><span class="content">File formats: general principles</span><a class="self-link" href="#file-formats-general-principles"></a></h3>
   <p>All signed metadata objects have the format:</p>
   <p>{ "signed" : ROLE,
         "signatures" : [
            { "keyid" : KEYID,
              "sig" : SIGNATURE }
            , ... ]
       }</p>
   <p>where:</p>
   <p>ROLE is a dictionary whose "_type" field describes the role type.</p>
   <p>KEYID is the identifier of the key signing the ROLE dictionary.</p>
   <p>SIGNATURE is a hex-encoded signature of the canonical form of
          the metadata for ROLE.</p>
   <p>All keys have the format:</p>
   <p>{ "keytype" : KEYTYPE,
          "scheme" : SCHEME,
          "keyval" : KEYVAL
        }</p>
   <p>where:</p>
   <p>KEYTYPE is a string denoting a public key signature system, such
          as RSA or ECDSA.</p>
   <p>SCHEME is a string denoting a corresponding signature scheme.  For
          example: "rsassa-pss-sha256" and "ecdsa-sha2-nistp256".</p>
   <p>KEYVAL is a dictionary containing the public portion of the key.</p>
   <p>The reference implementation defines three signature schemes, although TUF
   is not restricted to any particular signature scheme, key type, or
   cryptographic library:</p>
   <p>"rsassa-pss-sha256" : RSA Probabilistic signature scheme with appendix.
        The underlying hash function is SHA256.
        https://tools.ietf.org/html/rfc3447#page-29</p>
   <p>"ed25519" : Elliptic curve digital signature algorithm based on Twisted
        Edwards curves.
        https://ed25519.cr.yp.to/</p>
   <p>"ecdsa-sha2-nistp256" : Elliptic Curve Digital Signature Algorithm
         with NIST P-256 curve signing and SHA-256 hashing.
         https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm</p>
   <p>We define three keytypes below: <a class="property" data-link-type="propdesc">rsa</a>, <a class="property" data-link-type="propdesc">ed25519</a>, and <a class="property" data-link-type="propdesc">ecdsa</a>, but adopters
   can define and use any particular keytype, signing scheme, and cryptographic
   library.</p>
   <p>The <a class="property" data-link-type="propdesc">rsa</a> format is:</p>
   <p>{ "keytype" : "rsa",
          "scheme" : "rsassa-pss-sha256",
          "keyval" : {"public" : PUBLIC}
        }</p>
   <p>where PUBLIC is in PEM format and a string.  All RSA keys MUST be at least
   2048 bits.</p>
   <p>The <a class="property" data-link-type="propdesc">ed25519</a> format is:</p>
   <p>{ "keytype" : "ed25519",
          "scheme" : "ed25519",
          "keyval" : {"public" : PUBLIC}
        }</p>
   <p>where:</p>
   <p>PUBLIC is a 64-byte hex encoded string.</p>
   <p>The <a class="property" data-link-type="propdesc">ecdsa</a> format is:</p>
   <p>{ "keytype" : "ecdsa-sha2-nistp256",
          "scheme" : "ecdsa-sha2-nistp256",
          "keyval" : {"public" : PUBLIC}
        }</p>
   <p>where:</p>
   <p>PUBLIC is in PEM format and a string.</p>
   <p>The KEYID of a key is the hexdigest of the SHA-256 hash of the
   canonical form of the key.</p>
   <p>Metadata date-time data follows the ISO 8601 standard.  The expected format
   of the combined date and time string is "YYYY-MM-DDTHH:MM:SSZ".  Time is
   always in UTC, and the "Z" time zone designator is attached to indicate a
   zero UTC offset.  An example date-time string is "1985-10-21T01:21:00Z".</p>
   <h3 class="heading settled" data-level="4.3" id="file-formats-rootjson"><span class="secno">4.3. </span><span class="content">File formats: root.json</span><a class="self-link" href="#file-formats-rootjson"></a></h3>
   <p>The root.json file is signed by the root role’s keys.  It indicates
   which keys are authorized for all top-level roles, including the root
   role itself.  Revocation and replacement of top-level role keys, including
   for the root role, is done by changing the keys listed for the roles in
   this file.</p>
   <p>The "signed" portion of root.json is as follows:</p>
   <p>{ "_type" : "root",
         "spec_version" : SPEC_VERSION,
         "consistent_snapshot": CONSISTENT_SNAPSHOT,
         "version" : VERSION,
         "expires" : EXPIRES,
         "keys" : {
             KEYID : KEY
             , ... },
         "roles" : {
             ROLE : {
               "keyids" : [ KEYID, ... ] ,
               "threshold" : THRESHOLD }
             , ... }
       }</p>
   <p>SPEC_VERSION is a string that contains the version number of the TUF
   specification. Its format follows the [Semantic Versioning 2.0.0
   (semver)](https://semver.org/spec/v2.0.0.html) specification. Metadata is
   written according to version "spec_version" of the specification, and
   clients MUST verify that "spec_version" matches the expected version number.
   Adopters are free to determine what is considered a match (e.g., the version
   number exactly, or perhaps only the major version number (major.minor.fix).</p>
   <p>CONSISTENT_SNAPSHOT is a boolean indicating whether the repository supports
   consistent snapshots.  Section 7 goes into more detail on the consequences
   of enabling this setting on a repository.</p>
   <p>VERSION is an integer that is greater than 0.  Clients MUST NOT replace a
   metadata file with a version number less than the one currently trusted.</p>
   <p>EXPIRES determines when metadata should be considered expired and no longer
   trusted by clients.  Clients MUST NOT trust an expired file.</p>
   <p>A ROLE is one of "root", "snapshot", "targets", "timestamp", or "mirrors".
   A role for each of "root", "snapshot", "timestamp", and "targets" MUST be
   specified in the key list. The role of "mirror" is OPTIONAL.  If not
   specified, the mirror list will not need to be signed if mirror lists are
   being used.</p>
   <p>The KEYID MUST be correct for the specified KEY.  Clients MUST calculate
   each KEYID to verify this is correct for the associated key.  Clients MUST
   ensure that for any KEYID represented in this key list and in other files,
   only one unique key has that KEYID.</p>
   <p>The THRESHOLD for a role is an integer of the number of keys of that role
   whose signatures are required in order to consider a file as being properly
   signed by that role.</p>
   <p>A root.json example file:</p>
   <p>{
       "signatures": [
        {
         "keyid": "cb3fbd83df4ba2471a736b065650878280964a98843ec13b457a99b2a21cc3b4",
         "sig": "a312b9c3cb4a1b693e8ebac5ee1ca9cc01f2661c14391917dcb111517f72370809
                 f32c890c6b801e30158ac4efe0d4d87317223077784c7a378834249d048306"
        }
       ],
       "signed": {
        "_type": "root",
        "spec_version": "1.0.0",
        "consistent_snapshot": false,
        "expires": "2030-01-01T00:00:00Z",
        "keys": {
         "1bf1c6e3cdd3d3a8420b19199e27511999850f4b376c4547b2f32fba7e80fca3": {
          "keytype": "ed25519",
          "scheme": "ed25519",
          "keyval": {
           "public": "72378e5bc588793e58f81c8533da64a2e8f1565c1fcc7f253496394ffc52542c"
          }
         },
         "135c2f50e57ff11e744d234a62cebad8c38daf399604a7655661cc9199c69164": {
          "keytype": "ed25519",
          "scheme": "ed25519",
          "keyval": {
           "public": "68ead6e54a43f8f36f9717b10669d1ef0ebb38cee6b05317669341309f1069cb"
          }
         },
         "cb3fbd83df4ba2471a736b065650878280964a98843ec13b457a99b2a21cc3b4": {
          "keytype": "ed25519",
          "scheme": "ed25519",
          "keyval": {
           "public": "66dd78c5c2a78abc6fc6b267ff1a8017ba0e8bfc853dd97af351949bba021275"
          }
         },
         "66676daa73bdfb4804b56070c8927ae491e2a6c2314f05b854dea94de8ff6bfc": {
          "keytype": "ed25519",
          "scheme": "ed25519",
          "keyval": {
           "public": "01c61f8dc7d77fcef973f4267927541e355e8ceda757e2c402818dad850f856e"
          }
         }
        },
        "roles": {
         "root": {
          "keyids": [
           "cb3fbd83df4ba2471a736b065650878280964a98843ec13b457a99b2a21cc3b4"
          ],
          "threshold": 1
         },
         "snapshot": {
          "keyids": [
           "66676daa73bdfb4804b56070c8927ae491e2a6c2314f05b854dea94de8ff6bfc"
          ],
          "threshold": 1
         },
         "targets": {
          "keyids": [
           "135c2f50e57ff11e744d234a62cebad8c38daf399604a7655661cc9199c69164"
          ],
          "threshold": 1
         },
         "timestamp": {
          "keyids": [
           "1bf1c6e3cdd3d3a8420b19199e27511999850f4b376c4547b2f32fba7e80fca3"
          ],
          "threshold": 1
         }
        },
        "version": 1
       }
      }</p>
   <h3 class="heading settled" data-level="4.4" id="file-formats-snapshotjson"><span class="secno">4.4. </span><span class="content">File formats: snapshot.json</span><a class="self-link" href="#file-formats-snapshotjson"></a></h3>
   <p>The snapshot.json file is signed by the snapshot role. It MUST list the
   version numbers of the top-level targets metadata and all delegated targets
   metadata. It MAY also list their lengths and file hashes.</p>
   <p>The "signed" portion of snapshot.json is as follows:</p>
   <p>{ "_type" : "snapshot",
         "spec_version" : SPEC_VERSION,
         "version" : VERSION,
         "expires" : EXPIRES,
         "meta" : METAFILES
       }</p>
   <p>SPEC_VERSION, VERSION and EXPIRES are the same as is described for the root.json file.</p>
   <p>METAFILES is an object whose format is the following:</p>
   <p>{ METAPATH : {
             "version" : VERSION,
             ("length" : LENGTH, |
              "hashes" : HASHES) }
         , ...
       }</p>
   <p>METAPATH is the file path of the metadata on the repository relative to the
   metadata base URL. For snapshot.json, these are top-level targets metadata
   and delegated targets metadata.</p>
   <p>VERSION is the integer version number as shown in the metadata file at
   METAPATH.</p>
   <p>LENGTH is the integer length in bytes of the metadata file at METAPATH. It
   is OPTIONAL and can be omitted to reduce the snapshot metadata file size. In
   that case the client MUST use a custom download limit for the listed
   metadata.</p>
   <p>HASHES is a dictionary that specifies one or more hashes of the metadata
   file at METAPATH, including their cryptographic hash function. For example:
   { "sha256": HASH, ... }. HASHES is OPTIONAL and can be omitted to reduce
   the snapshot metadata file size.  In that case the repository MUST guarantee
   that VERSION alone unambiguously identifies the metadata at METAPATH.</p>
   <p>A snapshot.json example file:</p>
   <p>{ "signatures": [
         {
          "keyid": "66676daa73bdfb4804b56070c8927ae491e2a6c2314f05b854dea94de8ff6bfc",
          "sig": "f7f03b13e3f4a78a23561419fc0dd741a637e49ee671251be9f8f3fceedfc112e4
                  4ee3aaff2278fad9164ab039118d4dc53f22f94900dae9a147aa4d35dcfc0f"
         }
        ],
        "signed": {
         "_type": "snapshot",
         "spec_version": "1.0.0",
         "expires": "2030-01-01T00:00:00Z",
         "meta": {
          "targets.json": {
           "version": 1
          },
          "project1.json": {
           "version": 1,
           "hashes": {
            "sha256": "f592d072e1193688a686267e8e10d7257b4ebfcf28133350dae88362d82a0c8a"
           }
          },
          "project2.json": {
           "version": 1,
           "length": 604,
           "hashes": {
            "sha256": "1f812e378264c3085bb69ec5f6663ed21e5882bbece3c3f8a0e8479f205ffb91"
           }
          }
         },
         "version": 1
        }
       }</p>
   <h3 class="heading settled" data-level="4.5" id="file-formats-targetsjson-and-delegated-target-roles"><span class="secno">4.5. </span><span class="content">File formats: targets.json and delegated target roles</span><a class="self-link" href="#file-formats-targetsjson-and-delegated-target-roles"></a></h3>
   <p>The "signed" portion of targets.json is as follows:</p>
   <p>{ "_type" : "targets",
         "spec_version" : SPEC_VERSION,
         "version" : VERSION,
         "expires" : EXPIRES,
         "targets" : TARGETS,
         ("delegations" : DELEGATIONS)
       }</p>
   <p>SPEC_VERSION, VERSION and EXPIRES are the same as is described for the root.json file.</p>
   <p>TARGETS is an object whose format is the following:</p>
   <p>{ TARGETPATH : {
             "length" : LENGTH,
             "hashes" : HASHES,
             ("custom" : { ... }) }
         , ...
       }</p>
   <p>Each key of the TARGETS object is a TARGETPATH.  A TARGETPATH is a path to
   a file that is relative to a mirror’s base URL of targets. To avoid
   surprising behavior when resolving paths, it is RECOMMENDED that a
   TARGETPATH uses the forward slash (/) as directory separator and does not
   start with a directory separator. The recommendation for TARGETPATH aligns
   with the ["path-relative-URL string"
   definition](https://url.spec.whatwg.org/#path-relative-url-string) in the
   WHATWG URL specification.</p>
   <p>It is allowed to have a TARGETS object with no TARGETPATH elements.  This
   can be used to indicate that no target files are available.</p>
   <p>LENGTH is the integer length in bytes of the target file at TARGETPATH.</p>
   <p>HASHES is a dictionary that specifies one or more hashes, including the
   cryptographic hash function.  For example: { "sha256": HASH, ... }. HASH is
   the hexdigest of the cryptographic function computed on the target file.</p>
   <p>If defined, the elements and values of "custom" will be made available to the
   client application.  The information in "custom" is opaque to the framework
   and can include version numbers, dependencies, requirements, and any other
   data that the application wants to include to describe the file at
   TARGETPATH.  The application may use this information to guide download
   decisions.</p>
   <p>DELEGATIONS is an object whose format is the following:</p>
   <p>{ "keys" : {
             KEYID : KEY,
             ... },
         "roles" : [{
             "name": ROLENAME,
             "keyids" : [ KEYID, ... ] ,
             "threshold" : THRESHOLD,
             ("path_hash_prefixes" : [ HEX_DIGEST, ... ] |
              "paths" : [ PATHPATTERN, ... ]),
             "terminating": TERMINATING,
         }, ... ]
       }</p>
   <p>"keys" lists the public keys to verify signatures of delegated targets roles.
   Revocation and replacement of delegated targets roles keys is done by
   changing the keys in this field in the delegating role’s metadata.</p>
   <p>ROLENAME is the name of the delegated role.  For example,
   "projects".</p>
   <p>TERMINATING is a boolean indicating whether subsequent delegations should be
   considered.</p>
   <p>As explained in the [Diplomat
   paper](https://github.com/theupdateframework/tuf/blob/develop/docs/papers/protect-community-repositories-nsdi2016.pdf),
   terminating delegations instruct the client not to consider future trust
   statements that match the delegation’s pattern, which stops the delegation
   processing once this delegation (and its descendants) have been processed.
   A terminating delegation for a package causes any further statements about a
   package that are not made by the delegated party or its descendants to be
   ignored.</p>
   <p>In order to discuss target paths, a role MUST specify only one of the
   "path_hash_prefixes" or "paths" attributes, each of which we discuss next.</p>
   <p>The "path_hash_prefixes" list is used to succinctly describe a set of target
   paths. Specifically, each HEX_DIGEST in "path_hash_prefixes" describes a set
   of target paths; therefore, "path_hash_prefixes" is the union over each
   prefix of its set of target paths. The target paths must meet this
   condition: each target path, when hashed with the SHA-256 hash function to
   produce a 64-byte hexadecimal digest (HEX_DIGEST), must share the same
   prefix as one of the prefixes in "path_hash_prefixes". This is useful to
   split a large number of targets into separate bins identified by consistent
   hashing.</p>
   <p>The "paths" list describes paths that the role is trusted to provide.
   Clients MUST check that a target is in one of the trusted paths of all roles
   in a delegation chain, not just in a trusted path of the role that describes
   the target file.  PATHPATTERN can include shell-style wildcards and supports
   the Unix filename pattern matching convention.  Its format may either
   indicate a path to a single file, or to multiple paths with the use of
   shell-style wildcards.  For example, the path pattern "targets/*.tgz" would
   match file paths "targets/foo.tgz" and "targets/bar.tgz", but not
   "targets/foo.txt".  Likewise, path pattern "foo-version-?.tgz" matches
   "foo-version-2.tgz" and "foo-version-a.tgz", but not "foo-version-alpha.tgz".
   To avoid surprising behavior when matching targets with PATHPATTERN, it is
   RECOMMENDED that PATHPATTERN uses the forward slash (/) as directory
   separator and does not start with a directory separator, akin to
   TARGETSPATH.</p>
   <p>Prioritized delegations allow clients to resolve conflicts between delegated
   roles that share responsibility for overlapping target paths.  To resolve
   conflicts, clients must consider metadata in order of appearance of delegations;
   we treat the order of delegations such that the first delegation is trusted
   over the second one, the second delegation is trusted more than the third
   one, and so on. Likewise, the metadata of the first delegation will override that
   of the second delegation, the metadata of the second delegation will override
   that of the third one, etc. In order to accommodate prioritized
   delegations, the "roles" key in the DELEGATIONS object above points to an array
   of delegated roles, rather than to a hash table.</p>
   <p>The metadata files for delegated target roles has the same format as the
   top-level targets.json metadata file.</p>
   <p>A targets.json example file:</p>
   <p>{
       "signatures": [
        {
         "keyid": "135c2f50e57ff11e744d234a62cebad8c38daf399604a7655661cc9199c69164",
         "sig": "e9fd40008fba263758a3ff1dc59f93e42a4910a282749af915fbbea1401178e5a0
                 12090c228f06db1deb75ad8ddd7e40635ac51d4b04301fce0fd720074e0209"
        }
       ],
       "signed": {
        "_type": "targets",
        "spec_version": "1.0.0",
        "delegations": {
         "keys": {
          "f761033eb880143c52358d941d987ca5577675090e2215e856ba0099bc0ce4f6": {
           "keytype": "ed25519",
           "scheme": "ed25519",
           "keyval": {
            "public": "b6e40fb71a6041212a3d84331336ecaa1f48a0c523f80ccc762a034c727606fa"
           }
          }
         },
         "roles": [
          {
           "keyids": [
            "f761033eb880143c52358d941d987ca5577675090e2215e856ba0099bc0ce4f6"
           ],
           "name": "project",
           "paths": [
            "project/file3.txt"
           ],
           "threshold": 1
          }
         ]
        },
        "expires": "2030-01-01T00:00:00Z",
        "targets": {
         "file1.txt": {
          "hashes": {
           "sha256": "65b8c67f51c993d898250f40aa57a317d854900b3a04895464313e48785440da"
          },
          "length": 31
         },
         "dir/file2.txt": {
          "hashes": {
           "sha256": "452ce8308500d83ef44248d8e6062359211992fd837ea9e370e561efb1a4ca99"
          },
          "length": 39
         }
        },
        "version": 1
        }
       }</p>
   <h3 class="heading settled" data-level="4.6" id="file-formats-timestampjson"><span class="secno">4.6. </span><span class="content">File formats: timestamp.json</span><a class="self-link" href="#file-formats-timestampjson"></a></h3>
   <p>The timestamp file is signed by a timestamp key.  It indicates the latest
   version of the snapshot metadata and is frequently re-signed to limit the
   amount of time a client can be kept unaware of interference with obtaining
   updates.</p>
   <p>Timestamp files will potentially be downloaded very frequently.  Unnecessary
   information in them will be avoided.</p>
   <p>The "signed" portion of timestamp.json is as follows:</p>
   <p>{ "_type" : "timestamp",
         "spec_version" : SPEC_VERSION,
         "version" : VERSION,
         "expires" : EXPIRES,
         "meta" : METAFILES
       }</p>
   <p>SPEC_VERSION, VERSION and EXPIRES are the same as is described for the root.json file.</p>
   <p>METAFILES is the same as described for the snapshot.json file.  In the case
   of the timestamp.json file, this MUST only include a description of the
   snapshot.json file.</p>
   <p>A signed timestamp.json example file:</p>
   <p>{
       "signatures": [
        {
         "keyid": "1bf1c6e3cdd3d3a8420b19199e27511999850f4b376c4547b2f32fba7e80fca3",
         "sig": "90d2a06c7a6c2a6a93a9f5771eb2e5ce0c93dd580bebc2080d10894623cfd6eaed
                 f4df84891d5aa37ace3ae3736a698e082e12c300dfe5aee92ea33a8f461f02"
        }
       ],
       "signed": {
        "_type": "timestamp",
        "spec_version": "1.0.0",
        "expires": "2030-01-01T00:00:00Z",
        "meta": {
         "snapshot.json": {
          "hashes": {
           "sha256": "c14aeb4ac9f4a8fc0d83d12482b9197452f6adf3eb710e3b1e2b79e8d14cb681"
          },
          "length": 1007,
          "version": 1
         }
        },
        "version": 1
        }
       }</p>
   <h3 class="heading settled" data-level="4.7" id="file-formats-mirrorsjson"><span class="secno">4.7. </span><span class="content">File formats: mirrors.json</span><a class="self-link" href="#file-formats-mirrorsjson"></a></h3>
   <p>The mirrors.json file is signed by the mirrors role.  It indicates which
   mirrors are active and believed to be mirroring specific parts of the
   repository.</p>
   <p>The "signed" portion of mirrors.json is as follows:</p>
   <p>{ "_type" : "mirrors",
       "spec_version" : SPEC_VERSION,
       "version" : VERSION,
       "expires" : EXPIRES,
       "mirrors" : [
          { "urlbase" : URLBASE,
            "metapath" : METAPATH,
            "targetspath" : TARGETSPATH,
            "metacontent" : [ PATHPATTERN ... ] ,
            "targetscontent" : [ PATHPATTERN ... ] ,
            ("custom" : { ... }) }
          , ... ]
      }</p>
   <p>URLBASE is the URL of the mirror which METAPATH and TARGETSPATH are relative
   to.  All metadata files will be retrieved from METAPATH and all target files
   will be retrieved from TARGETSPATH.</p>
   <p>The lists of PATHPATTERN for "metacontent" and "targetscontent" describe the
   metadata files and target files available from the mirror.</p>
   <p>The order of the list of mirrors is important.  For any file to be
   downloaded, whether it is a metadata file or a target file, the framework on
   the client will give priority to the mirrors that are listed first.  That is,
   the first mirror in the list whose "metacontent" or "targetscontent" include
   a path that indicate the desired file can be found there will the first
   mirror that will be used to download that file.  Successive mirrors with
   matching paths will only be tried if downloading from earlier mirrors fails.
   This behavior can be modified by the client code that uses the framework to,
   for example, randomly select from the listed mirrors.</p>
   <h2 class="heading settled" data-level="5" id="detailed-workflows"><span class="secno">5. </span><span class="content">Detailed Workflows</span><a class="self-link" href="#detailed-workflows"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="the-client-application"><span class="secno">5.1. </span><span class="content">The client application</span><a class="self-link" href="#the-client-application"></a></h3>
   <p class="note" role="note"><span>Note:</span> If a step in the following workflow does not succeed (e.g., the update
  is aborted because a new metadata file was not signed), the client should
  still be able to update again in the future. Errors raised during the update
  process should not leave clients in an unrecoverable state.</p>
   <h3 class="heading settled" data-level="5.2" id="load-the-trusted-root-metadata-file"><span class="secno">5.2. </span><span class="content">Load the trusted root metadata file.</span><a class="self-link" href="#load-the-trusted-root-metadata-file"></a></h3>
   <p>We assume that a good,
  trusted copy of this file was shipped with the package manager or software
  updater using an out-of-band process.  Note that the expiration of the
  trusted root metadata file does not matter, because we will attempt to update
  it in the next step.</p>
   <h3 class="heading settled" data-level="5.3" id="update-the-root-metadata-file"><span class="secno">5.3. </span><span class="content">Update the root metadata file.</span><a class="self-link" href="#update-the-root-metadata-file"></a></h3>
   <p>Since it may now be signed using
  entirely different keys, the client MUST somehow be able to establish a
  trusted line of continuity to the latest set of keys (see Section 6.1). To do
  so, the client MUST download intermediate root metadata files, until the
  latest available one is reached. Therefore, it MUST temporarily turn on
  consistent snapshots in order to download _versioned_ root metadata files as
  described next.</p>
   <h4 class="heading settled" data-level="5.3.1" id="let-n-denote-the-version-number-of-the-trusted-root-metadata"><span class="secno">5.3.1. </span><span class="content">Let N denote the version number of the trusted root metadata</span><a class="self-link" href="#let-n-denote-the-version-number-of-the-trusted-root-metadata"></a></h4>
    file. 
   <h4 class="heading settled" data-level="5.3.2" id="try-downloading-version-n1-of-the-root-metadata-file"><span class="secno">5.3.2. </span><span class="content">Try downloading version N+1 of the root metadata file</span><a class="self-link" href="#try-downloading-version-n1-of-the-root-metadata-file"></a></h4>
   <p>, up to
    some W number of bytes (because the size is unknown). The value for W is set
    by the authors of the application using TUF. For example, W may be tens of
    kilobytes. The filename used to download the root metadata file is of the
    fixed form VERSION_NUMBER.FILENAME.EXT (e.g., 42.root.json). If this file is
    not available, or we have downloaded more than Y number of root metadata
    files (because the exact number is as yet unknown), then go to step 5.1.9.
    The value for Y is set by the authors of the application using TUF. For
    example, Y may be 2^10.</p>
   <h4 class="heading settled" data-level="5.3.3" id="check-for-an-arbitrary-software-attack"><span class="secno">5.3.3. </span><span class="content">Check for an arbitrary software attack</span><a class="self-link" href="#check-for-an-arbitrary-software-attack"></a></h4>
   <p>Version N+1 of the root
    metadata file MUST have been signed by: (1) a threshold of keys specified in
    the trusted root metadata file (version N), and (2) a threshold of keys
    specified in the new root metadata file being validated (version N+1).  If
    version N+1 is not signed as required, discard it, abort the update cycle,
    and report the signature failure.  On the next update cycle, begin at step
    5.0 and version N of the root metadata file.</p>
   <h4 class="heading settled" data-level="5.3.4" id="check-for-a-rollback-attack"><span class="secno">5.3.4. </span><span class="content">Check for a rollback attack.**</span><a class="self-link" href="#check-for-a-rollback-attack"></a></h4>
   <p>The version number of the trusted
    root metadata file (version N) MUST be less than or equal to the version
    number of the new root metadata file (version N+1). Effectively, this means
    checking that the version number signed in the new root metadata file is
    indeed N+1.  If the version of the new root metadata file is less than the
    trusted metadata file, discard it, abort the update cycle, and report the
    rollback attack.  On the next update cycle, begin at step 5.0 and version N
    of the root metadata file.</p>
   <h4 class="heading settled" data-level="5.3.5" id="note-that-the-expiration-of-the-new-intermediate-root-metadata"><span class="secno">5.3.5. </span><span class="content">Note that the expiration of the new (intermediate) root metadata</span><a class="self-link" href="#note-that-the-expiration-of-the-new-intermediate-root-metadata"></a></h4>
    file does not matter yet, because we will check for it in step 5.1.9. 
   <h4 class="heading settled" data-level="5.3.6" id="set-the-trusted-root-metadata-file"><span class="secno">5.3.6. </span><span class="content">Set the trusted root metadata file</span><a class="self-link" href="#set-the-trusted-root-metadata-file"></a></h4>
   <p>to the new root metadata
    file.</p>
   <h4 class="heading settled" data-level="5.3.7" id="persist-root-metadata"><span class="secno">5.3.7. </span><span class="content">Persist root metadata</span><a class="self-link" href="#persist-root-metadata"></a></h4>
   <p>The client MUST write the file to
    non-volatile storage as FILENAME.EXT (e.g. root.json).</p>
   <h4 class="heading settled" data-level="5.3.8" id="repeat-steps-511-to-518"><span class="secno">5.3.8. </span><span class="content">Repeat steps 5.1.1 to 5.1.8</span><a class="self-link" href="#repeat-steps-511-to-518"></a></h4>
   <h4 class="heading settled" data-level="5.3.9" id="check-for-a-freeze-attack"><span class="secno">5.3.9. </span><span class="content">Check for a freeze attack</span><a class="self-link" href="#check-for-a-freeze-attack"></a></h4>
   <p>The latest known time MUST be
    lower than the expiration timestamp in the trusted root metadata file
    (version N).  If the trusted root metadata file has expired, abort the update
    cycle, report the potential freeze attack.  On the next update cycle, begin
    at step 5.0 and version N of the root metadata file.</p>
   <h4 class="heading settled" data-level="5.3.10" id="if-the-timestamp-and-or-snapshot-keys-have-been-rotated"><span class="secno">5.3.10. </span><span class="content">If the timestamp and / or snapshot keys have been rotated,</span><a class="self-link" href="#if-the-timestamp-and-or-snapshot-keys-have-been-rotated"></a></h4>
   <p>then delete the trusted timestamp and snapshot metadata files.** This is done
    in order to recover from fast-forward attacks after the repository has been
    compromised and recovered. A _fast-forward attack_ happens when attackers
    arbitrarily increase the version numbers of: (1) the timestamp metadata, (2)
    the snapshot metadata, and / or (3) the targets, or a delegated targets,
    metadata file in the snapshot metadata. Please see [the Mercury
    paper](https://ssl.engineering.nyu.edu/papers/kuppusamy-mercury-usenix-2017.pdf)
    for more details.</p>
   <h4 class="heading settled" data-level="5.3.11" id="set-whether-consistent-snapshots-are-used-as-per-the-trusted"><span class="secno">5.3.11. </span><span class="content">**Set whether consistent snapshots are used as per the trusted</span><a class="self-link" href="#set-whether-consistent-snapshots-are-used-as-per-the-trusted"></a></h4>
    root metadata file** (see Section 4.3). 
   <h3 class="heading settled" data-level="5.4" id="download-the-timestamp-metadata-file-up-to-x-number-of-bytes"><span class="secno">5.4. </span><span class="content">**Download the timestamp metadata file**, up to X number of bytes</span><a class="self-link" href="#download-the-timestamp-metadata-file-up-to-x-number-of-bytes"></a></h3>
    (because the size is unknown). The value for X is set by the authors of the
  application using TUF. For example, X may be tens of kilobytes. The filename
  used to download the timestamp metadata file is of the fixed form FILENAME.EXT
  (e.g., timestamp.json). 
   <h4 class="heading settled" data-level="5.4.1" id="check-for-an-arbitrary-software-attack①"><span class="secno">5.4.1. </span><span class="content">Check for an arbitrary software attack</span><a class="self-link" href="#check-for-an-arbitrary-software-attack①"></a></h4>
   <p>The new timestamp
    metadata file MUST have been signed by a threshold of keys specified in the
    trusted root metadata file.  If the new timestamp metadata file is not
    properly signed, discard it, abort the update cycle, and report the signature
    failure.</p>
   <h4 class="heading settled" data-level="5.4.2" id="check-for-a-rollback-attack①"><span class="secno">5.4.2. </span><span class="content">Check for a rollback attack</span><a class="self-link" href="#check-for-a-rollback-attack①"></a></h4>
   <h5 class="heading settled" data-level="5.4.2.1" id="the-version-number-of-the-trusted-timestamp-metadata-file-if"><span class="secno">5.4.2.1. </span><span class="content">The version number of the trusted timestamp metadata file, if</span><a class="self-link" href="#the-version-number-of-the-trusted-timestamp-metadata-file-if"></a></h5>
    any, MUST be less than or equal to the version number of the new timestamp
      metadata file.  If the new timestamp metadata file is older than the
      trusted timestamp metadata file, discard it, abort the update cycle, and
      report the potential rollback attack. 
   <h5 class="heading settled" data-level="5.4.2.2" id="the-version-number-of-the-snapshot-metadata-file-in-the"><span class="secno">5.4.2.2. </span><span class="content">The version number of the snapshot metadata file in the</span><a class="self-link" href="#the-version-number-of-the-snapshot-metadata-file-in-the"></a></h5>
    trusted timestamp metadata file, if any, MUST be less than or equal to its
      version number in the new timestamp metadata file.  If not, discard the new
      timestamp metadata file, abort the update cycle, and report the failure. 
   <h4 class="heading settled" data-level="5.4.3" id="check-for-a-freeze-attack①"><span class="secno">5.4.3. </span><span class="content">Check for a freeze attack</span><a class="self-link" href="#check-for-a-freeze-attack①"></a></h4>
   <p>The latest known time MUST be
    lower than the expiration timestamp in the new timestamp metadata file.  If
    so, the new timestamp metadata file becomes the trusted timestamp metadata
    file.  If the new timestamp metadata file has expired, discard it, abort the
    update cycle, and report the potential freeze attack.</p>
   <h4 class="heading settled" data-level="5.4.4" id="persist-timestamp-metadata"><span class="secno">5.4.4. </span><span class="content">Persist timestamp metadata</span><a class="self-link" href="#persist-timestamp-metadata"></a></h4>
   <p>The client MUST write the file
    to non-volatile storage as FILENAME.EXT (e.g. timestamp.json).</p>
   <h3 class="heading settled" data-level="5.5" id="download-snapshot-metadata-file-up-to-either-the-number-of-bytes"><span class="secno">5.5. </span><span class="content">**Download snapshot metadata file**, up to either the number of bytes</span><a class="self-link" href="#download-snapshot-metadata-file-up-to-either-the-number-of-bytes"></a></h3>
    specified in the timestamp metadata file, or some Y number of bytes. The value
  for Y is set by the authors of the application using TUF. For example, Y may be
  tens of kilobytes. If consistent snapshots are not used (see
  Section 7), then the filename used to download the snapshot metadata file is of
  the fixed form FILENAME.EXT (e.g., snapshot.json).  Otherwise, the filename is
  of the form VERSION_NUMBER.FILENAME.EXT (e.g., 42.snapshot.json), where
  VERSION_NUMBER is the version number of the snapshot metadata file listed in
  the timestamp metadata file. 
   <h4 class="heading settled" data-level="5.5.1" id="check-against-timestamp-metadata"><span class="secno">5.5.1. </span><span class="content">Check against timestamp metadata</span><a class="self-link" href="#check-against-timestamp-metadata"></a></h4>
   <p>The hashes and version
    number of the new snapshot metadata file MUST match the hashes, if any, and
    version number listed in the trusted timestamp metadata.  If hashes and
    version do not match, discard the new snapshot metadata, abort the update
    cycle, and report the failure.</p>
   <h4 class="heading settled" data-level="5.5.2" id="check-for-an-arbitrary-software-attack②"><span class="secno">5.5.2. </span><span class="content">Check for an arbitrary software attack</span><a class="self-link" href="#check-for-an-arbitrary-software-attack②"></a></h4>
   <p>The new snapshot
    metadata file MUST have been signed by a threshold of keys specified in the
    trusted root metadata file.  If the new snapshot metadata file is not signed
    as required, discard it, abort the update cycle, and report the signature
    failure.</p>
   <h4 class="heading settled" data-level="5.5.3" id="check-for-a-rollback-attack②"><span class="secno">5.5.3. </span><span class="content">Check for a rollback attack</span><a class="self-link" href="#check-for-a-rollback-attack②"></a></h4>
   <p>The version number of the targets
    metadata file, and all delegated targets metadata files, if any, in the
    trusted snapshot metadata file, if any, MUST be less than or equal to its
    version number in the new snapshot metadata file. Furthermore, any targets
    metadata filename that was listed in the trusted snapshot metadata file, if
    any, MUST continue to be listed in the new snapshot metadata file.  If any of
    these conditions are not met, discard the new snapshot metadata file, abort
    the update cycle, and report the failure.</p>
   <h4 class="heading settled" data-level="5.5.4" id="check-for-a-freeze-attack②"><span class="secno">5.5.4. </span><span class="content">Check for a freeze attack</span><a class="self-link" href="#check-for-a-freeze-attack②"></a></h4>
   <p>The latest known time MUST be
    lower than the expiration timestamp in the new snapshot metadata file.  If
    so, the new snapshot metadata file becomes the trusted snapshot metadata
    file. If the new snapshot metadata file is expired, discard it, abort the
    update cycle, and report the potential freeze attack.</p>
   <h4 class="heading settled" data-level="5.5.5" id="persist-snapshot-metadata"><span class="secno">5.5.5. </span><span class="content">Persist snapshot metadata</span><a class="self-link" href="#persist-snapshot-metadata"></a></h4>
   <p>The client MUST write the file to
    non-volatile storage as FILENAME.EXT (e.g. snapshot.json).</p>
   <h3 class="heading settled" data-level="5.6" id="download-the-top-level-targets-metadata-file-up-to-either-the"><span class="secno">5.6. </span><span class="content">**Download the top-level targets metadata file**, up to either the</span><a class="self-link" href="#download-the-top-level-targets-metadata-file-up-to-either-the"></a></h3>
    number of bytes specified in the snapshot metadata file, or some Z number of
  bytes. The value for Z is set by the authors of the application using TUF. For
  example, Z may be tens of kilobytes.  If consistent snapshots are not used (see
  Section 7), then the filename used to download the targets metadata file is of
  the fixed form FILENAME.EXT (e.g., targets.json).  Otherwise, the filename is
  of the form VERSION_NUMBER.FILENAME.EXT (e.g., 42.targets.json), where
  VERSION_NUMBER is the version number of the targets metadata file listed in the
  snapshot metadata file. 
   <h4 class="heading settled" data-level="5.6.1" id="check-against-snapshot-metadata"><span class="secno">5.6.1. </span><span class="content">Check against snapshot metadata</span><a class="self-link" href="#check-against-snapshot-metadata"></a></h4>
   <p>The hashes and version
    number of the new targets metadata file MUST match the hashes, if any, and
    version number listed in the trusted snapshot metadata.  This is done, in
    part, to prevent a mix-and-match attack by man-in-the-middle attackers.  If
    the new targets metadata file does not match, discard it, abort the update
    cycle, and report the failure.</p>
   <h4 class="heading settled" data-level="5.6.2" id="check-for-an-arbitrary-software-attack③"><span class="secno">5.6.2. </span><span class="content">**Check for an arbitrary software attack</span><a class="self-link" href="#check-for-an-arbitrary-software-attack③"></a></h4>
   <p>The new targets
    metadata file MUST have been signed by a threshold of keys specified in the
    trusted root metadata file.  If the new targets metadata file is not signed
    as required, discard it, abort the update cycle, and report the failure.</p>
   <h4 class="heading settled" data-level="5.6.3" id="check-for-a-freeze-attack③"><span class="secno">5.6.3. </span><span class="content">**Check for a freeze attack</span><a class="self-link" href="#check-for-a-freeze-attack③"></a></h4>
   <p>The latest known time MUST be
    lower than the expiration timestamp in the new targets metadata file.  If so,
    the new targets metadata file becomes the trusted targets metadata file.  If
    the new targets metadata file is expired, discard it, abort the update cycle,
    and report the potential freeze attack.</p>
   <h4 class="heading settled" data-level="5.6.4" id="persist-targets-metadata"><span class="secno">5.6.4. </span><span class="content">Persist targets metadata</span><a class="self-link" href="#persist-targets-metadata"></a></h4>
   <p>The client MUST write the file to
    non-volatile storage as FILENAME.EXT (e.g. targets.json).</p>
   <h4 class="heading settled" data-level="5.6.5" id="perform-a-pre-order-depth-first-search-for-metadata-about-the-desired-target-beginning-with-the-top-level-targets-role"><span class="secno">5.6.5. </span><span class="content">Perform a pre-order depth-first search for metadata about the desired target, beginning with the top-level targets role</span><a class="self-link" href="#perform-a-pre-order-depth-first-search-for-metadata-about-the-desired-target-beginning-with-the-top-level-targets-role"></a></h4>
   <p class="note" role="note"><span>Note:</span> If
    any metadata requested in steps 5.4.5.1 - 5.4.5.2 cannot be downloaded nor
    validated, end the search and report that the target cannot be found.</p>
   <h5 class="heading settled" data-level="5.6.5.1" id="if-this-role-has-been-visited-before-then-skip-this-role"><span class="secno">5.6.5.1. </span><span class="content">If this role has been visited before, then skip this role</span><a class="self-link" href="#if-this-role-has-been-visited-before-then-skip-this-role"></a></h5>
    (so that cycles in the delegation graph are avoided).  Otherwise, if an
      application-specific maximum number of roles have been visited, then go to
      step 5.5 (so that attackers cannot cause the client to waste excessive
      bandwidth or time).  Otherwise, if this role contains metadata about the
      desired target, then go to step 5.5. 
   <h5 class="heading settled" data-level="5.6.5.2" id="otherwise-recursively-search-the-list-of-delegations-in"><span class="secno">5.6.5.2. </span><span class="content">Otherwise, recursively search the list of delegations in</span><a class="self-link" href="#otherwise-recursively-search-the-list-of-delegations-in"></a></h5>
    order of appearance. 
   <h6 class="heading settled" data-level="5.6.5.2.1" id="if-the-current-delegation-is-a-multi-role-delegation"><span class="secno">5.6.5.2.1. </span><span class="content">If the current delegation is a multi-role delegation,</span><a class="self-link" href="#if-the-current-delegation-is-a-multi-role-delegation"></a></h6>
    recursively visit each role, and check that each has signed exactly the
        same non-custom metadata (i.e., length and hashes) about the target (or
        the lack of any such metadata). 
   <h6 class="heading settled" data-level="5.6.5.2.2" id="if-the-current-delegation-is-a-terminating-delegation"><span class="secno">5.6.5.2.2. </span><span class="content">If the current delegation is a terminating delegation,</span><a class="self-link" href="#if-the-current-delegation-is-a-terminating-delegation"></a></h6>
    then jump to step 5.5. 
   <h6 class="heading settled" data-level="5.6.5.2.3" id="otherwise-if-the-current-delegation-is-a"><span class="secno">5.6.5.2.3. </span><span class="content">Otherwise, if the current delegation is a</span><a class="self-link" href="#otherwise-if-the-current-delegation-is-a"></a></h6>
    non-terminating delegation, continue processing the next delegation, if
        any. Stop the search, and jump to step 5.5 as soon as a delegation
        returns a result. 
   <h3 class="heading settled" data-level="5.7" id="verify-the-desired-target-against-its-targets-metadata"><span class="secno">5.7. </span><span class="content">**Verify the desired target against its targets metadata**.</span><a class="self-link" href="#verify-the-desired-target-against-its-targets-metadata"></a></h3>
   <h4 class="heading settled" data-level="5.7.1" id="if-there-is-no-targets-metadata-about-this-target-abort-the"><span class="secno">5.7.1. </span><span class="content">If there is no targets metadata about this target, abort the</span><a class="self-link" href="#if-there-is-no-targets-metadata-about-this-target-abort-the"></a></h4>
    update cycle and report that there is no such target. 
   <h4 class="heading settled" data-level="5.7.2" id="otherwise-download-the-target-up-to-the-number-of-bytes"><span class="secno">5.7.2. </span><span class="content">Otherwise, download the target (up to the number of bytes</span><a class="self-link" href="#otherwise-download-the-target-up-to-the-number-of-bytes"></a></h4>
    specified in the targets metadata), and verify that its hashes match the
    targets metadata. (We download up to this number of bytes, because in some
    cases, the exact number is unknown. This may happen, for example, if an
    external program is used to compute the root hash of a tree of targets files,
    and this program does not provide the total size of all of these files.) If
    consistent snapshots are not used (see Section 7), then the filename used to
    download the target file is of the fixed form FILENAME.EXT (e.g.,
    foobar.tar.gz).  Otherwise, the filename is of the form HASH.FILENAME.EXT
    (e.g.,
    c14aeb4ac9f4a8fc0d83d12482b9197452f6adf3eb710e3b1e2b79e8d14cb681.foobar.tar.gz),
    where HASH is one of the hashes of the targets file listed in the targets
    metadata file found earlier in step 4.  In either case, the client MUST write
    the file to non-volatile storage as FILENAME.EXT. 
   <h2 class="heading settled" data-level="6" id="usage"><span class="secno">6. </span><span class="content">Usage</span><a class="self-link" href="#usage"></a></h2>
   <p>See https://theupdateframework.io/ for discussion of recommended usage
   in various situations.</p>
   <h3 class="heading settled" data-level="6.1" id="key-management-and-migration"><span class="secno">6.1. </span><span class="content">Key management and migration</span><a class="self-link" href="#key-management-and-migration"></a></h3>
   <p>All keys, except those for the timestamp and mirrors roles, should be
   stored securely offline (e.g. encrypted and on a separate machine, in
   special-purpose hardware, etc.).  This document does not prescribe how keys
   should be encrypted and stored, and so it is left to implementers of
   this document to decide how best to secure them.</p>
   <p>To replace a compromised root key or any other top-level role key, the root
   role signs a new root.json file that lists the updated trusted keys for the
   role.  When replacing root keys, an application will sign the new root.json
   file with both the new and old root keys. Any time such a change is
   required, the root.json file is versioned and accessible by version number,
   e.g., 3.root.json.</p>
   <p>Clients that have outdated root keys can update to the latest set of trusted
   root keys, by incrementally downloading all intermediate root metadata
   files, and verifying that each current version of the root metadata is
   signed by a threshold of keys specified by its immediate predecessor as well
   as a threshold of keys specified by itself.
   For example, if there is a 1.root.json that has threshold 2 and a
   2.root.json that has threshold 3, 2.root.json MUST be signed by at least 2
   keys defined in 1.root.json and at least 3 keys defined in 2.root.json. The
   client starts the root key update process with the latest version of root
   metadata available on the client, and stops when no version N+1 (where N is
   the latest trusted version) of the root metadata is available from the
   repository. This ensures that an outdated client can always correctly
   re-trace the chain of trust across multiple root key updates, even if the
   latest set of root keys on the client dates back multiple root metadata
   versions. See step 5.1 of the client application workflow for more details.</p>
   <p>Note that an attacker, who controls the repository, can launch freeze
   attacks by withholding new root metadata. The attacker does not need to
   compromise root keys to do so. However, these freeze attacks are limited by
   the expiration time of the latest root metadata available to the client.</p>
   <p>To replace a delegated developer key, the role that delegated to that key
   just replaces that key with another in the signed metadata where the
   delegation is done.</p>
   <h2 class="heading settled" data-level="7" id="consistent-snapshots"><span class="secno">7. </span><span class="content">Consistent Snapshots</span><a class="self-link" href="#consistent-snapshots"></a></h2>
   <p>So far, we have considered a TUF repository that is relatively static (in
   terms of how often metadata and target files are updated). The problem is
   that if the repository (which may be a community repository such as PyPI,
   RubyGems, CPAN, or SourceForge) is volatile, in the sense that the
   repository is continually producing new TUF metadata as well as its targets,
   then should clients read metadata while the same metadata is being written
   to, they would effectively see denial-of-service attacks.  Therefore, the
   repository needs to be careful about how it writes metadata and targets. The
   high-level idea of the solution is that each snapshot will be contained in a
   so-called consistent snapshot. If a client is reading from one consistent
   snapshot, then the repository is free to write another consistent snapshot
   without interrupting that client.</p>
   <h3 class="heading settled" data-level="7.1" id="writing-consistent-snapshots"><span class="secno">7.1. </span><span class="content">Writing consistent snapshots</span><a class="self-link" href="#writing-consistent-snapshots"></a></h3>
   <p>We now explain how a repository should write metadata and targets to
    produce self-contained consistent snapshots.</p>
   <p>Simply put, TUF should write every metadata file as such: if the
    file had the original name of filename.ext, then it should be written to
    non-volatile storage as version_number.filename.ext, where version_number
    is an integer.</p>
   <p>On the other hand, consistent target files should be written to
    non-volatile storage as digest.filename.ext.  This means that if the
    referrer metadata lists N cryptographic hashes of the referred file, then
    there must be N identical copies of the referred file, where each file will
    be distinguished only by the value of the digest in its filename. The
    modified filename need not include the name of the cryptographic hash
    function used to produce the digest because, on a read, the choice of
    function follows from the selection of a digest (which includes the name of
    the cryptographic function) from all digests in the referred file.</p>
   <p>Additionally, the timestamp metadata (timestamp.json) should also be
    written to non-volatile storage whenever it is updated. It is OPTIONAL for
    an implementation to write identical copies at
    version_number.timestamp.json for record-keeping purposes, because a
    cryptographic hash of the timestamp metadata is usually not known in
    advance. The same step applies to the root metadata (root.json), although
    an implementation must write both root.json and version_number.root.json
    because it is possible to download root metadata both with and without
    known version numbers. These steps are required because these are the only
    metadata files that may be requested without known version numbers.</p>
   <p>Most importantly, no metadata file format must be updated to refer to the
    names of metadata or target files with their version numbers included. In
    other words, if a metadata file A refers to another metadata file B as
    filename.ext, then the filename must remain as filename.ext and not
    version_number.filename.ext. This rule is in place so that metadata signed
    by roles with offline keys will not be forced to sign for the metadata file
    whenever it is updated. In the next subsection, we will see how clients
    will reproduce the name of the intended file.</p>
   <p>Finally, the root metadata should write the Boolean "consistent_snapshot"
    attribute at the root level of its keys of attributes. If consistent
    snapshots are not written by the repository, then the attribute may either
    be left unspecified or be set to the False value.  Otherwise, it must be
    set to the True value.</p>
   <p>Regardless of whether consistent snapshots are ever used or not, all
    released versions of root metadata files should always be provided
    so that outdated clients can update to the latest available root.</p>
   <h3 class="heading settled" data-level="7.2" id="reading-consistent-snapshots"><span class="secno">7.2. </span><span class="content">Reading consistent snapshots</span><a class="self-link" href="#reading-consistent-snapshots"></a></h3>
   <p>See Section 5.1 for more details.</p>
   <h2 class="heading settled" data-level="8" id="future-directions-and-open-questions"><span class="secno">8. </span><span class="content">Future directions and open questions</span><a class="self-link" href="#future-directions-and-open-questions"></a></h2>
   <h3 class="heading settled" data-level="8.1" id="support-for-bogus-clocks"><span class="secno">8.1. </span><span class="content">Support for bogus clocks.</span><a class="self-link" href="#support-for-bogus-clocks"></a></h3>
   <p>The framework may need to offer an application-enablable "no, my clock is
   _supposed_ to be wrong" mode, since others have noticed that many users seem
   to have incorrect clocks.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content"> Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p> Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification. </p>
   <p> All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p> Examples in this specification are introduced with the words “for example”
            or are set apart from the normative text with <code>class="example"</code>, like this: </p>
   <div class="example" id="example-example"><a class="self-link" href="#example-example"></a> This is an example of an informative example. </div>
   <p> Informative notes begin with the word “Note”
            and are set apart from the normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note"> Note, this is an informative note. </p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
  </dl>